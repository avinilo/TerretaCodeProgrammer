import{u as V,r as v,j as c}from"./components-CPkOdgym.js";import{M as e,O as y,Q as X,R as Y,S as K,U as Q,V as D,W as P,X as W,Y as Z,Z as ee,_ as C,$ as A,a0 as O,a1 as te,a2 as ae,a3 as re,a4 as ne,a5 as oe,a6 as se,a7 as ie,a8 as ue}from"./index-CGBtkmMC.js";import"./stripIndent-Cq3xGT5m.js";var ce=Object.defineProperty,w=(t,a)=>{for(var n in a)ce(t,n,{get:a[n],enumerable:!0})};function N(t,{contentType:a,dataStreamVersion:n}){const r=new Headers(t??{});return r.has("Content-Type")||r.set("Content-Type",a),n!==void 0&&r.set("X-Vercel-AI-Data-Stream",n),r}var F="AI_NoObjectGeneratedError",k=`vercel.ai.error.${F}`,le=Symbol.for(k),U,E=class extends D{constructor({message:t="No object generated.",cause:a,text:n,response:r,usage:o}){super({name:F,message:t,cause:a}),this[U]=!0,this.text=n,this.response=r,this.usage=o}static isInstance(t){return D.hasMarker(t,k)}};U=le;var q=e.union([e.string(),e.instanceof(Uint8Array),e.instanceof(ArrayBuffer),e.custom(t=>{var a,n;return(n=(a=globalThis.Buffer)==null?void 0:a.isBuffer(t))!=null?n:!1},{message:"Must be a Buffer"})]),T=e.lazy(()=>e.union([e.null(),e.string(),e.number(),e.boolean(),e.record(e.string(),T),e.array(T)])),m=e.record(e.string(),e.record(e.string(),T)),de=e.array(e.union([e.object({type:e.literal("text"),text:e.string()}),e.object({type:e.literal("image"),data:e.string(),mimeType:e.string().optional()})])),G=e.object({type:e.literal("text"),text:e.string(),experimental_providerMetadata:m.optional()}),me=e.object({type:e.literal("image"),image:e.union([q,e.instanceof(URL)]),mimeType:e.string().optional(),experimental_providerMetadata:m.optional()}),pe=e.object({type:e.literal("file"),data:e.union([q,e.instanceof(URL)]),mimeType:e.string(),experimental_providerMetadata:m.optional()}),fe=e.object({type:e.literal("tool-call"),toolCallId:e.string(),toolName:e.string(),args:e.unknown()}),he=e.object({type:e.literal("tool-result"),toolCallId:e.string(),toolName:e.string(),result:e.unknown(),content:de.optional(),isError:e.boolean().optional(),experimental_providerMetadata:m.optional()}),ge=e.object({role:e.literal("system"),content:e.string(),experimental_providerMetadata:m.optional()}),Se=e.object({role:e.literal("user"),content:e.union([e.string(),e.array(e.union([G,me,pe]))]),experimental_providerMetadata:m.optional()}),ye=e.object({role:e.literal("assistant"),content:e.union([e.string(),e.array(e.union([G,fe]))]),experimental_providerMetadata:m.optional()}),xe=e.object({role:e.literal("tool"),content:e.array(he),experimental_providerMetadata:m.optional()});e.union([ge,Se,ye,xe]);var ve="JSON schema:",Te="You MUST answer with a JSON object that matches the JSON schema above.",we="You MUST answer with JSON.";function je({prompt:t,schema:a,schemaPrefix:n=a!=null?ve:void 0,schemaSuffix:r=a!=null?Te:we}){return[t!=null&&t.length>0?t:void 0,t!=null&&t.length>0?"":void 0,n,a!=null?JSON.stringify(a):void 0,r].filter(o=>o!=null).join(`
`)}y({prefix:"aiobj",size:24});y({prefix:"aiobj",size:24});y({prefix:"aitxt",size:24});var be={};w(be,{object:()=>Re,text:()=>_e});var _e=()=>({type:"text",responseFormat:()=>({type:"text"}),injectIntoSystemPrompt({system:t}){return t},parsePartial({text:t}){return{partial:t}},parseOutput({text:t}){return t}}),Re=({schema:t})=>{const a=X(t);return{type:"object",responseFormat:({model:n})=>({type:"json",schema:n.supportsStructuredOutputs?a.jsonSchema:void 0}),injectIntoSystemPrompt({system:n,model:r}){return r.supportsStructuredOutputs?n:je({prompt:n,schema:a.jsonSchema})},parsePartial({text:n}){const r=Y(n);switch(r.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:r.value};default:{const o=r.state;throw new Error(`Unsupported parse state: ${o}`)}}},parseOutput({text:n},r){const o=K({text:n});if(!o.success)throw new E({message:"No object generated: could not parse the response.",cause:o.error,text:n,response:r.response,usage:r.usage});const s=Q({value:o.value,schema:a});if(!s.success)throw new E({message:"No object generated: response did not match schema.",cause:s.error,text:n,response:r.response,usage:r.usage});return s.value}}};function $(t,a){const n=t.getReader(),r=a.getReader();let o,s,l=!1,p=!1;async function h(i){try{o==null&&(o=n.read());const u=await o;o=void 0,u.done?i.close():i.enqueue(u.value)}catch(u){i.error(u)}}async function S(i){try{s==null&&(s=r.read());const u=await s;s=void 0,u.done?i.close():i.enqueue(u.value)}catch(u){i.error(u)}}return new ReadableStream({async pull(i){try{if(l){await S(i);return}if(p){await h(i);return}o==null&&(o=n.read()),s==null&&(s=r.read());const{result:u,reader:g}=await Promise.race([o.then(f=>({result:f,reader:n})),s.then(f=>({result:f,reader:r}))]);u.done||i.enqueue(u.value),g===n?(o=void 0,u.done&&(await S(i),l=!0)):(s=void 0,u.done&&(p=!0,await h(i)))}catch(u){i.error(u)}},cancel(){n.cancel(),r.cancel()}})}y({prefix:"aitxt",size:24});var Ie={};w(Ie,{mergeIntoDataStream:()=>Ee,toDataStream:()=>De,toDataStreamResponse:()=>Ce});function B(t={}){const a=new TextEncoder;let n="";return new TransformStream({async start(){t.onStart&&await t.onStart()},async transform(r,o){o.enqueue(a.encode(r)),n+=r,t.onToken&&await t.onToken(r),t.onText&&typeof r=="string"&&await t.onText(r)},async flush(){t.onCompletion&&await t.onCompletion(n),t.onFinal&&await t.onFinal(n)}})}function j(t,a){return t.pipeThrough(new TransformStream({transform:async(n,r)=>{var o;if(typeof n=="string"){r.enqueue(n);return}if("event"in n){n.event==="on_chat_model_stream"&&M((o=n.data)==null?void 0:o.chunk,r);return}M(n,r)}})).pipeThrough(B(a)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(n,r)=>{r.enqueue(P("text",n))}}))}function De(t,a){return j(t,a).pipeThrough(new TextEncoderStream)}function Ce(t,a){var n;const r=j(t,a?.callbacks).pipeThrough(new TextEncoderStream),o=a?.data,s=a?.init,l=o?$(o.stream,r):r;return new Response(l,{status:(n=s?.status)!=null?n:200,statusText:s?.statusText,headers:N(s?.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function Ee(t,a){a.dataStream.merge(j(t,a.callbacks))}function M(t,a){if(typeof t.content=="string")a.enqueue(t.content);else{const n=t.content;for(const r of n)r.type==="text"&&a.enqueue(r.text)}}var Me={};w(Me,{mergeIntoDataStream:()=>Oe,toDataStream:()=>Pe,toDataStreamResponse:()=>Ae});function b(t,a){const n=Ne();return W(t[Symbol.asyncIterator]()).pipeThrough(new TransformStream({async transform(r,o){o.enqueue(n(r.delta))}})).pipeThrough(B(a)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(r,o)=>{o.enqueue(P("text",r))}}))}function Pe(t,a){return b(t,a).pipeThrough(new TextEncoderStream)}function Ae(t,a={}){var n;const{init:r,data:o,callbacks:s}=a,l=b(t,s).pipeThrough(new TextEncoderStream),p=o?$(o.stream,l):l;return new Response(p,{status:(n=r?.status)!=null?n:200,statusText:r?.statusText,headers:N(r?.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function Oe(t,a){a.dataStream.merge(b(t,a.callbacks))}function Ne(){let t=!0;return a=>(t&&(a=a.trimStart(),a&&(t=!1)),a)}const Fe=["node_modules/**",".git/**",".github/**",".vscode/**","**/*.jpg","**/*.jpeg","**/*.png","dist/**","build/**",".next/**","coverage/**",".cache/**",".vscode/**",".idea/**","**/*.log","**/.DS_Store","**/npm-debug.log*","**/yarn-debug.log*","**/yarn-error.log*","**/*lock.json","**/*lock.yaml"];function ke(){const[t]=V(),{ready:a,importChat:n}=Z(),{ready:r,gitClone:o}=ee(),[s,l]=v.useState(!1),[p,h]=v.useState(!0),S=async i=>{if(!(!r&&!a)&&i){const u=re().add(Fe);try{const{workdir:g,data:f}=await o(i);if(n){const J=Object.keys(f).filter(d=>!u.ignores(d)),z=new TextDecoder("utf-8"),_=J.map(d=>{const{data:x,encoding:L}=f[d];return{path:d,content:L==="utf8"?x:x instanceof Uint8Array?z.decode(x):""}}).filter(d=>d.content),H=await ne(_),R=oe(H),I=[{role:"assistant",content:`Cloning the repo ${i} into ${g}
<TerretacodeArtifact id="imported-files" title="Git Cloned Files" type="bundled">
${_.map(d=>`<TerretacodeAction type="file" filePath="${d.path}">
${d.content}
</TerretacodeAction>`).join(`
`)}
</TerretacodeArtifact>`,id:se(),createdAt:new Date}];R&&I.push(R),await n(`Git Project:${i.split("/").slice(-1)[0]}`,I)}}catch(g){console.error("Error during import:",g),C.error("Failed to import repository"),h(!1),window.location.href="/";return}}};return v.useEffect(()=>{if(!a||!r||s)return;const i=t.get("url");if(!i){window.location.href="/";return}S(i).catch(u=>{console.error("Error importing repo:",u),C.error("Failed to import repository"),h(!1),window.location.href="/"}),l(!0)},[t,a,r,s]),c.jsx(A,{fallback:c.jsx(O,{}),children:()=>c.jsxs(c.Fragment,{children:[c.jsx(te,{}),p&&c.jsx(ae,{message:"Please wait while we clone the repository..."})]})})}const Be=()=>[{title:"Terretacode"},{name:"description",content:"Talk with Terretacode, an AI assistant from StackBlitz"}];function Je(){return c.jsxs("div",{className:"flex flex-col h-full w-full bg-Terretacode-elements-background-depth-1",children:[c.jsx(ie,{}),c.jsx(ue,{}),c.jsx(A,{fallback:c.jsx(O,{}),children:()=>c.jsx(ke,{})})]})}export{Je as default,Be as meta};
